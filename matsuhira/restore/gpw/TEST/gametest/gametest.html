<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WWAっぽいテスト</title>
<script src="jquery.js"></script>
<script>
var gw;
var FPS = 30;
var frameSeconds;
var timer;
var px,py;
var dispPx,dispPy;
var pressedKey = null;
var mode = null;
var moveCount = 0;
onload = function(){
	frameSeconds = 1000 / FPS ;
	gw = document.getElementById("gameWindow").getContext("2d");
	px = 5;
	py = 5;
			dispPx = px * 40;
		dispPy = py * 40;
	$("#test").html("テストですー。");
	mode = "active";
	timer = setInterval("runGame()",frameSeconds);
}
function runGame(){
	gw.clearRect(0,0,440,440);
	if(mode == "active"){
		//入力
		$(window).keydown(function(e){
			pressedKey = e.keyCode;
			return false;
		});
		if(pressedKey == 37){
			px -= 1;
			//dispPx -= 2;
			mode = "moveLeft";
		}else if(pressedKey == 38){
			py -= 1;
			//dispPy -= 2;
			mode = "moveUp";
		}else if(pressedKey == 39){
			px += 1;
			//dispPx += 2;
			mode = "moveRight";
		}else if(pressedKey == 40){
			py += 1;
			//dispPy += 2;
			mode = "moveDown";
		}
		//dispPx = px * 40;
		//dispPy = py * 40;
		
		//キー入力数値解除
		pressedKey = null;
		
	}else if(mode == "moveLeft"){
		dispPx -= 2;
		moveCount++;
	}else if(mode == "moveUp"){
		dispPy -= 2;
		moveCount++;
	}else if(mode == "moveRight"){
		dispPx += 2;
		moveCount++;
	}else if(mode == "moveDown"){
		dispPy += 2;
		moveCount++;
	}
	
	if(moveCount >= 5){
		mode = "active";
		moveCount = 0;
	}
	
	//背景を描画
	drawBackground();
	
	//プレーヤー描画
	gw.fillStyle = 'rgb(0,255,255)';
	gw.beginPath();
	gw.fillRect(dispPx,dispPy,40,40);
	
	gw.fillStyle = 'rgb(255,255,255)';
	gw.beginPath();
	gw.fillText("　px="+px+"　py="+py+"　dispPx="+dispPx+"　dispPy="+dispPy,20,20);
}

function drawBackground(){
	gw.fillStyle = 'rgb(0,0,0)';
	gw.beginPath();
	gw.fillRect(0,0,440,440);
}
</script>
</head>
<body>
<canvas id="gameWindow" width="440" height="440">
</canvas>
<div id="test">
</div>
</body>
</html>